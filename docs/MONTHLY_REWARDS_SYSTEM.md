# ูุธุงู ุฌูุงุฆุฒ ุงูุดูุฑ ุงููุงุถู ๐

## ูุธุฑุฉ ุนุงูุฉ
ูุธุงู ุชููุงุฆู ูููุญ ุฌูุงุฆุฒ ูููุชุตุฏุฑูู ูู ุงูุดูุฑ ุงููุงุถู ุจูุงุกู ุนูู ุงููุจูุบ ุงููููู.

## ุฌุฏูู ุงูููุงูุขุช
- ๐ฅ **ุงููุฑูุฒ ุงูุฃูู**: 40 LYD
- ๐ฅ **ุงููุฑูุฒ ุงูุซุงูู**: 25 LYD  
- ๐ฅ **ุงููุฑูุฒ ุงูุซุงูุซ**: 10 LYD
- **ุงููุฑุงูุฒ 4-7**: 1 LYD ููู ูุฑูุฒ
- **ุงููุฑุงูุฒ 8-10**: ูุง ุชูุฌุฏ ููุงูุขุช

## ุงููููุงุช ุงููุถุงูุฉ

### 1. ุฎุฏูุฉ ุฅุฏุงุฑุฉ ุงูุฌูุงุฆุฒ
**ุงูููู**: `src/Services/MonthlyRewardsService.php`

**ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ**:
- `processPreviousMonthRewards()`: ุชูููุฐ ุฌูุงุฆุฒ ุงูุดูุฑ ุงููุงุถู
- `canExecuteRewards()`: ุงูุชุญูู ูู ุฅููุงููุฉ ุงูุชูููุฐ
- `getLastRewardExecution()`: ุฌูุจ ุชุงุฑูุฎ ุขุฎุฑ ุชูููุฐ

### 2. ูุงุฌูุฉ ุงูุฅุฏุงุฑุฉ
**ุงููููุงุช**: 
- `admin/dashboard.php` - ุฒุฑ ูู ููุญุฉ ุงูุชุญูู ุงูุฑุฆูุณูุฉ
- `admin/wallet_approvals.php` - ุฒุฑ ูู ุตูุญุฉ ุฅุฏุงุฑุฉ ุงููุญุงูุธ
- `admin/execute_rewards.php` - API ูุชูููุฐ ุงูุฌูุงุฆุฒ

### 3. ุงูุชูููุฐ ุงูุชููุงุฆู
**ุงูููู**: `monthly_rewards_cron.php` - cron job ููุชูููุฐ ุงูุชููุงุฆู

## ููููุฉ ุงูุงุณุชุฎุฏุงู

### ุงูุชูููุฐ ุงููุฏูู
1. ุงูุชูู ุฅูู ููุญุฉ ุงูุชุญูู ุงูุฅุฏุงุฑูุฉ
2. ุงุถุบุท ุนูู ุฒุฑ "๐ ุชูููุฐ ุฌูุงุฆุฒ ุงูุดูุฑ ุงููุงุถู"
3. ุชุฃููุฏ ุงูุนูููุฉ ูู ุงููุงูุฐุฉ ุงูููุจุซูุฉ
4. ุนุฑุถ ุงููุชุงุฆุฌ

### ุงูุชูููุฐ ุงูุชููุงุฆู
ุฅุถุงูุฉ ุฅูู crontab:
```bash
# ุชูููุฐ ูู ุงูุฃูู ูู ูู ุดูุฑ ูู ุงูุณุงุนุฉ 00:01
1 0 1 * * /usr/bin/php /path/to/monthly_rewards_cron.php
```

ุฃู ูู Windows Task Scheduler:
```cmd
schtasks /create /tn "Monthly Rewards" /tr "php.exe monthly_rewards_cron.php" /sc monthly /d 1 /st 00:01
```

## ุงููููุฒุงุช ุงูุฃูููุฉ

### 1. Idempotency (ุนุฏู ุงูุชูุฑุงุฑ)
- ุงุณุชุฎุฏุงู `reference` ูุฑูุฏ ููู ููุงูุฃุฉ
- ุงูุชุญูู ูู ุนุฏู ูุฌูุฏ ุงูููุงูุฃุฉ ูุณุจูุงู
- ููุน ููุญ ุงูููุงูุฃุฉ ูุฑุชูู ูููุณ ุงููุณุชุฎุฏู

### 2. ุงููุนุงููุงุช ุงูุขููุฉ
- ุงุณุชุฎุฏุงู `START TRANSACTION` ู `COMMIT/ROLLBACK`
- ุถูุงู ุชูููุฐ ุฌููุน ุงูููุงูุขุช ุฃู ุนุฏู ุชูููุฐ ุฃู ูููุง

### 3. ุงูุชุณุฌูู ุงูุดุงูู
- ุชุณุฌูู ุฌููุน ุงูุนูููุงุช ูู ููู ุงูุณุฌู
- ุชุชุจุน ุงููุณุชุฎุฏููู ุงูุฐูู ุชู ููุญูู ุงูุฌูุงุฆุฒ
- ุชุชุจุน ุงููุณุชุฎุฏููู ุงูุฐูู ุชู ุชุฎุทููู

## ูููู ุงูุจูุงูุงุช

### ูุนุงููุงุช ุงููุญูุธุฉ
```sql
INSERT INTO wallet_transactions (
    user_id, 
    amount, 
    type, 
    reference, 
    description, 
    created_at
) VALUES (
    :uid, 
    :amt, 
    'credit', 
    :ref, 
    :desc, 
    NOW()
);
```

### ูุซุงู ุนูู ุงููุฑุฌุน ุงููุฑูุฏ
```
TOP-2024-01-R01-U123
```
- `TOP`: ููุน ุงูููุงูุฃุฉ
- `2024-01`: ุงูุดูุฑ ุงููุณุชูุฏู
- `R01`: ุงููุฑูุฒ ุงูุฃูู
- `U123`: ูุนุฑู ุงููุณุชุฎุฏู

## ุงูุณุฌูุงุช

### ููู ุงูุณุฌู ุงูุฑุฆูุณู
**ุงููููุน**: `logs/monthly_rewards_cron.log`

**ูุซุงู ุนูู ุงูุณุฌู**:
```
[2024-02-01 00:01:15] ุจุฏุก ุชูููุฐ ุฌูุงุฆุฒ ุงูุดูุฑ ุงููุงุถู ุชููุงุฆูุงู
[2024-02-01 00:01:16] ุชู ุชูููุฐ ุงูุฌูุงุฆุฒ ุจูุฌุงุญ - ุชู ูุนุงูุฌุฉ 7 ูุณุชุฎุฏูููุ ุฅุฌูุงูู ุงููุจูุบ: 78.00 LYD
[2024-02-01 00:01:17] ุชู ุฅุฑุณุงู ุฅุดุนุงุฑ ูููุฏูุฑ
[2024-02-01 00:01:17] ุงูุชูุงุก ุชูููุฐ ุฌูุงุฆุฒ ุงูุดูุฑ ุงููุงุถู
```

### ุณุฌู ุงูุชุฏููู ุงูุฅุฏุงุฑู
**ุงููููุน**: `logs/admin.log`

ูุชู ุชุณุฌูู ุฌููุน ุงูุนูููุงุช ุงูุฅุฏุงุฑูุฉ ูุน ุชูุงุตูู ุงููุฏูุฑ ุงูุฐู ููุฐ ุงูุนูููุฉ.

## ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ูุดุงูู ุดุงุฆุนุฉ

1. **"ุชู ุชูููุฐ ุฌูุงุฆุฒ ุงูุดูุฑ ุงููุงุถู ูุณุจูุงู"**
   - ุงูุณุจุจ: ุชู ุชูููุฐ ุงูุฌูุงุฆุฒ ุจุงููุนู
   - ุงูุญู: ุงูุชุธุฑ ุงูุดูุฑ ุงูุชุงูู ุฃู ุชุญูู ูู ุงูุณุฌูุงุช

2. **"ูุง ุชูุฌุฏ ุจูุงูุงุช ููุดูุฑ ุงููุงุถู"**
   - ุงูุณุจุจ: ุนุฏู ูุฌูุฏ ูุนุงููุงุช ูู ุงูุดูุฑ ุงููุงุถู
   - ุงูุญู: ุชุญูู ูู ุจูุงูุงุช `wallet_transactions`

3. **"ูุดู ูู ุฅุถุงูุฉ ุงูููุงูุฃุฉ"**
   - ุงูุณุจุจ: ุฎุทุฃ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
   - ุงูุญู: ุชุญูู ูู ุงูุณุฌูุงุช ูุงุชุตุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ูุญุต ุงูุญุงูุฉ
```php
// ุงูุชุญูู ูู ุฅููุงููุฉ ุงูุชูููุฐ
$canExecute = MonthlyRewardsService::canExecuteRewards();

// ุฌูุจ ุชุงุฑูุฎ ุขุฎุฑ ุชูููุฐ
$lastExecution = MonthlyRewardsService::getLastRewardExecution();

// ุฌูุจ ุฌุฏูู ุงูููุงูุขุช
$rewardTable = MonthlyRewardsService::getRewardTable();
```

## ุงูุชุฎุตูุต

### ุชุบููุฑ ุฌุฏูู ุงูููุงูุขุช
ุนุฏูู ุงููุตูููุฉ ูู `MonthlyRewardsService.php`:
```php
private static $rewardTable = [
    1 => 50,  // ุฒูุงุฏุฉ ุงููุฑูุฒ ุงูุฃูู ุฅูู 50 LYD
    2 => 30,  // ุฒูุงุฏุฉ ุงููุฑูุฒ ุงูุซุงูู ุฅูู 30 LYD
    3 => 15,  // ุฒูุงุฏุฉ ุงููุฑูุฒ ุงูุซุงูุซ ุฅูู 15 LYD
    // ... ุจุงูู ุงููุฑุงูุฒ
];
```

### ุฅุถุงูุฉ ูุฑุงูุฒ ุฌุฏูุฏุฉ
```php
private static $rewardTable = [
    1 => 40,
    2 => 25,
    3 => 10,
    4 => 5,   // ุฅุถุงูุฉ ููุงูุฃุฉ ูููุฑูุฒ ุงูุฑุงุจุน
    5 => 3,   // ุฅุถุงูุฉ ููุงูุฃุฉ ูููุฑูุฒ ุงูุฎุงูุณ
    6 => 2,   // ุฅุถุงูุฉ ููุงูุฃุฉ ูููุฑูุฒ ุงูุณุงุฏุณ
    7 => 1,
    8 => 1,   // ุฅุถุงูุฉ ููุงูุฃุฉ ูููุฑูุฒ ุงูุซุงูู
];
```

## ุงูุฏุนู ูุงููุณุงุนุฏุฉ

ููุญุตูู ุนูู ุงููุณุงุนุฏุฉ ุฃู ุงูุฅุจูุงุบ ุนู ูุดุงูู:
1. ุชุญูู ูู ูููุงุช ุงูุณุฌู
2. ุฑุงุฌุน ูุฐุง ุงูุฏููู
3. ุงุชุตู ุจูุฑูู ุงูุชุทููุฑ

---
**ุชู ุชุทููุฑ ุงููุธุงู ุจูุงุณุทุฉ ูุฑูู ุงูุชุทููุฑ** ๐

